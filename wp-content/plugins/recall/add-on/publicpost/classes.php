<?phpclass Get_Child_Terms_Rcl{		function get_terms_post($post_cat){		foreach($post_cat as $key=>$p_cat){			foreach($post_cat as $pc){				if($pc->parent==$p_cat->term_id){					unset($post_cat[$key]);					break;				}									}		}		$cnt = count($post_cat);		foreach($post_cat as $data){			if($cnt>1){				if($data->parent==0) continue;			}			$cat_list[] = $data;		}		return $cat_list;	}}class List_Terms_rcl{	public $a;	public $ctg;	public $sel;	public $cat_list;	public $allcats;		function get_select_list($allcats,$cat_list,$cnt,$ctg){			if($ctg) $this->ctg = $ctg;						$this->allcats = $allcats;		$this->cat_list = $cat_list;		for($this->sel=0;$this->sel<$cnt;$this->sel++){			$catlist .= '<p><select class="postform" name="cat[]">';			if($this->sel>0) $catlist .= '<option value="">Не выбрано</option>';			$catlist .= $this->get_option_list();			$catlist .= '</select></p>';		}		return $catlist;	}		function get_option_list(){			if($this->ctg){			$ctg_ar = explode(',',$this->ctg);			$cnt_c = count($ctg_ar);		}				foreach($this->allcats as $cat){									$child = '';			$this->a = '';						if($this->ctg){				for($z=0;$z<$cnt_c;$z++){					if($ctg_ar[$z]==$cat->term_id){						$catlist .= $this->get_loop_child($cat);					}				}							}else{				if($cat->parent!=0) continue;				$catlist .= $this->get_loop_child($cat);			}		}		return $catlist;	}		function get_loop_child($cat){		$child = $this->get_child_option($cat->term_id,$this->a);		if($child) $catlist = '<optgroup label="'.$cat->name.'">'.$child.'</optgroup>';		else $catlist = '<option '.selected($this->cat_list[$this->sel]->term_id,$cat->term_id,false).' value="'.$cat->term_id.'">'.$cat->name.'</option>';				return $catlist;	}	function get_child_option($term_id,$a){		foreach($this->allcats as $cat){			if($cat->parent!=$term_id) continue;			$child = '';			$b = '-'.$a;			$child = $this->get_child_option($cat->term_id,$b);			if($child) $catlist .= '<optgroup label=" '.$b.' '.$cat->name.'">'.$child.'</optgroup>';			else $catlist .= '<option '.selected($this->cat_list[$this->sel]->term_id,$cat->term_id,false).' value="'.$cat->term_id.'">'.$cat->name.'</option>';			$this->a = $a;		}		return $catlist;	}		function get_parent_option($child,$term_id,$a){		foreach($this->allcats as $cat){			if($cat->term_id!=$term_id) continue;			$parent = '<optgroup label="'.$cat->name.'">'.$child.'</optgroup>';		}		return $parent;	}}class Edit_Terms_List_rcl{	public $cats;	public $new_cat = array();	function get_terms_list($cats,$post_cat){		$this->cats = $cats;		$this->new_cat = $post_cat;		$cnt = count($post_cat);		for($a=0;$a<$cnt;$a++){			foreach($cats as $cat){				if($cat->term_id!=$post_cat[$a]) continue;				if($cat->parent==0) continue;				$this->new_cat = $this->get_parents($cat->term_id);			}		}		return $this->new_cat;	}	function get_parents($term_id){		foreach($this->cats as $cat){			if($cat->term_id!=$term_id) continue;			if($cat->parent==0) continue;						$this->new_cat[] = $cat->parent;			$this->new_cat = $this->get_parents($cat->parent);		}		return $this->new_cat;	}}?>