jQuery(function(){ jQuery('#userpic').fileapi({ url: 'http://localhost/wordpress/wp-content/plugins/recall/add-on/profile/upload-avatar.php', accept: 'image/*', imageSize: { minWidth: 150, minHeight: 150 }, maxSize: 3000 * FileAPI.MB, elements: { active: { show: '#userpic-btn .js-upload', hide: '#userpic-btn .js-browse' }, preview: { el: '.js-preview', width: 150, height: 150 }, progress: '#userpic-btn .js-progress' }, onSelect: function (evt, ui){ ui.files; if( ui.other.length ){ var errors = ui.other[0].errors; if( errors ){ errors.maxSize; errors.maxFiles; errors.minWidth; errors.minHeight; errors.maxWidth; errors.maxHeight; } } var file = ui.files[0]; if( file ){ jQuery('#popup').modal({ closeOnEsc: true, closeOnOverlayClick: false, onOpen: function (overlay){ jQuery(overlay).on('click', '.js-upload', function (){ jQuery.modal().close(); jQuery('#userpic').fileapi('upload'); }); jQuery('.js-img', overlay).cropper({ file: file, bgColor: '#fff', maxSize: [jQuery(window).width()-100, jQuery(window).height()-100], minSize: [150, 150], selection: '90%', onSelect: function (coords){ jQuery('#userpic').fileapi('crop', file, coords); } }); } }).open(); } }, onUpload:function(evt, uiEvt){ jQuery('.userpic-notice').empty(); }, onComplete:function(evt, uiEvt){ var result = uiEvt.result; if(result['result']){ jQuery('.userpic-notice').html(result['result']); } } }); jQuery('#webcam-btn').fileapi({ url: 'http://localhost/wordpress/wp-content/plugins/recall/add-on/profile/upload-avatar.php', autoUpload: true, elements: { active: { show: '#webcam-btn .js-upload', hide: '#webcam-btn .js-webcam' }, preview: { el: '#userpic .js-preview', width: 150, height: 150 }, progress: '#webcam-btn .js-progress' } }); jQuery('.js-webcam').click(function (evt){ var modal = jQuery('#popup').modal({ closeOnOverlayClick: false, onOpen: function (overlay){ jQuery('.js-img', overlay).webcam({ width: 320, height: 320, error: function (err){ jQuery.modal().close(); alert("Похоже, что ваш браузер не поддерживает эту возможность"); }, success: function (webcam){ jQuery(overlay).on('click', '.js-upload', function (){ jQuery('#webcam-btn').fileapi('add', webcam.shot()); modal.close(); }); } }); }, onClose: function (overlay){ jQuery('.js-img', overlay).webcam('destroy'); }, onUpload:function(evt, uiEvt){ jQuery('.userpic-notice').empty(); }, onComplete:function(evt, uiEvt){ var result = uiEvt.result; if(result['result']){ jQuery('.userpic-notice').html(result['result']); } } }); modal.open(); evt.preventDefault(); }); FileAPI.each(examples, function (fn){ fn(); });});